generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
}

model User {
  id          String   @id @default(cuid())
  email       String   @unique
  password    String?
  role        UserRole
  walletAddress String @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  genomicData GenomicData[]
  researchAccess ResearchAccess[]
  labResults   LabResult[]
  
  @@map("users")
}

model GenomicData {
  id          String   @id @default(cuid())
  userId      String
  dataHash    String   @unique
  dataType    String
  size        Int
  isEncrypted Boolean  @default(true)
  ipfsHash    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessLogs  AccessLog[]
  researchAccess ResearchAccess[]
  
  @@map("genomic_data")
}

model LabResult {
  id          String   @id @default(cuid())
  userId      String
  labId       String
  testName    String
  result      String
  status      String
  createdAt   DateTime @default(now())
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("lab_results")
}

model ResearchAccess {
  id            String   @id @default(cuid())
  researcherId  String
  genomicDataId String
  accessLevel   String
  purpose       String
  expiresAt     DateTime?
  createdAt     DateTime @default(now())
  
  researcher    User     @relation(fields: [researcherId], references: [id])
  genomicData   GenomicData @relation(fields: [genomicDataId], references: [id], onDelete: Cascade)
  
  @@unique([researcherId, genomicDataId])
  @@map("research_access")
}

model AccessLog {
  id           String   @id @default(cuid())
  genomicDataId String
  accessedBy   String
  accessType   String
  timestamp    DateTime @default(now())
  ipfsHash     String?
  
  genomicData  GenomicData @relation(fields: [genomicDataId], references: [id], onDelete: Cascade)
  
  @@map("access_logs")
}

enum UserRole {
  PATIENT
  LAB
  RESEARCHER
}
